services:
  # 向量数据库服务
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant-db
    ports:
      - "6333:6333"
    volumes:
      # 持久化到宿主机本地目录 ./qdrant_storage
      - ./qdrant_storage:/qdrant/storage
    restart: always

  # 你的应用运行环境
  app:
    image: python:3.11-slim
    container_name: langchain-app
    working_dir: /app
    ports:
      - "8217:8217"
    env_file:
      - ./.env
    volumes:
      - ./app:/app
      - ./data:/data
      - ./requirements.txt:/app/requirements.txt:ro
      - ./.env:/app/.env:ro
    # 保持容器运行，以便我们可以进入容器执行命令
    command: sh -c "pip install --no-cache-dir -r /app/requirements.txt && tail -f /dev/null"
    depends_on:
      - qdrant
